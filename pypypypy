import psycopg2

connection = None
cursor = None

try:
    connection = psycopg2.connect(
        dbname="nominatim",
        user="nominatim",
        password="nominatim",
        host="127.0.0.1",
        port="5432"
    )

    cursor = connection.cursor()
    cursor.execute("""
                SELECT place_id, osm_id, osm_type, ST_Y(ST_Centroid(centroid)) AS lat, ST_X(ST_Centroid(centroid)) AS lon 
                FROM placex 
                WHERE class = 'building' 
                AND address -> 'street' ILIKE '%NIEGOCIÅƒSKA%' 
                AND address -> 'city' ILIKE '%WARSZAWA%' 
                AND postcode = '02-698' 
                AND address -> 'housenumber' ILIKE '%2A%';
            """)

    rows = cursor.fetchall()
    for row in rows:
        print(row)
    cursor.execute("SELECT version();")

    db_version = cursor.fetchone()
    print(f"Connected to PostgreSQL database, version: {db_version}")

except Exception as error:
    print(f"Error connecting to PostgreSQL database: {error}")

finally:
    if cursor is not None:
        cursor.close()
    if connection is not None:
        connection.close()
