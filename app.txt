import socket
import urllib.parse

def geocode_address(street, city, postal_code):
    server_address = 'dft-everace'
    server_port = 8080

    # Prepare query parameters
    address_query = f"{street} {city} {postal_code}"
    query = urllib.parse.quote(address_query)

    # Create a socket
    try:
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        print("Socket successfully created")
    except socket.error as err:
        print(f"Socket creation failed with error {err}")
        return

    # Connect to the server
    try:
        sock.connect((server_address, server_port))
        print("Successfully connected to the server")
    except socket.error as err:
        print(f"Connection to server failed with error {err}")
        return

    # Prepare HTTP GET request
    request = f"GET /search.php?q={query} HTTP/1.1\r\nHost: {server_address}\r\n\r\n"
    try:
        sock.sendall(request.encode())
    except socket.error as err:
        print(f"Failed to send request: {err}")
        return

    # Receive response
    try:
        response = sock.recv(4096)
        response_str = response.decode()
        print("Full response received from server:")
        print(response_str)
    except socket.error as err:
        print(f"Failed to receive response: {err}")
    finally:
        sock.close()

def main():
    # Example address
    street = "WANDY RUTKIEWICZ"
    city = "Wroc≈Çaw"
    postal_code = "50-571"

    geocode_address(street, city, postal_code)

if __name__ == "__main__":
    main()

