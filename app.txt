# Załaduj potrzebne biblioteki
library(ggplot2)
library(reshape2)

# Sprawdzenie struktury danych
head(paid_triangle)

# Krok 2: Ekstrakcja danych sprzed 2008 roku (zakładając, że dane przed 2008 to pierwsze 17 wierszy)
pre_2008 <- paid_triangle[1:17, ]

# Krok 3: Analiza trendów sprzed 2008 roku
# Obliczanie wartości inkrementalnych dla każdej kolumny
pre_2008_increments <- diff(as.matrix(pre_2008), lag = 1)

# Sprawdzenie, czy istnieją wartości nie-NA w danych przed 2008
if (sum(!is.na(pre_2008_increments)) > 0) {
  # Krok 4: Ekstrapolacja trendów na lata po 2008 roku
  # Proste modelowanie liniowe na podstawie danych sprzed 2008 roku
  rownames(pre_2008_increments) <- 2:nrow(pre_2008)  # Dodanie nazw wierszy do modelu
  model <- lm(pre_2008_increments ~ as.numeric(rownames(pre_2008_increments)))
  
  # Prognozowanie wartości dla lat po 2008 roku
  predicted_increments <- predict(model, newdata = data.frame(rownames(paid_triangle[18:nrow(paid_triangle), ])))
  
  # Krok 5: Porównanie alternatywnego trójkąta z rzeczywistymi danymi
  # Wyciągnięcie rzeczywistych danych po 2008 roku
  post_2008_real <- as.matrix(paid_triangle[18:nrow(paid_triangle), ])
  
  # Obliczenie różnic między prognozowanymi a rzeczywistymi wartościami
  differences <- post_2008_real - predicted_increments
  
  # Wizualizacja różnic
  matplot(differences, type = "l", main = "Różnice między prognozowanymi a rzeczywistymi wartościami po 2008 roku")
  
  # Krok 6: Analiza wyników i wnioski
  summary(differences)
  
} else {
  print("Brak danych do dopasowania modelu.")
}
