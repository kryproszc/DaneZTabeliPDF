library(leaflet)
library(htmlwidgets)
library(webshot2)
library(officer)
library(magrittr)

# Tworzenie nowego dokumentu Word
doc <- read_docx()

# Zakładam, że masz listę dataframe'ów lub inny sposób na generowanie danych do map
for (i in 1:n) {
  # Tworzenie mapy (przykład dla każdej iteracji)
  map <- leaflet(jednostki_data[[i]]) %>%
    addTiles() %>%
    setView(lng = 19.1451, lat = 51.9194, zoom = 6) %>%
    addPolygons(fillColor = ~ifelse(Value == 0, "transparent", pal(Value)), color = "#BDBDC3", weight = 1,
                fillOpacity = 0.7, smoothFactor = 0.5,
                popup = ~paste(JPT_NAZWA_, "<br>", "dddd", ": ", Value)) %>%
    addLegend(pal = pal, values = ~Value, opacity = 0.7, title = "Skala", position = "bottomright")
  
  # Renderowanie mapy jako plik HTML do pamięci
  html_file <- tempfile(fileext = ".html")
  saveWidget(map, file = html_file, selfcontained = TRUE)
  
  # Konwersja HTML na obraz PNG
  img_file <- tempfile(fileext = ".png")
  webshot2::webshot(html_file, file = img_file, cliprect = "viewport", vwidth = 800, vheight = 600)

  # Dodanie obrazu do dokumentu Word
  doc <- doc %>% 
    body_add_par(paste("Mapa jednostek", i), style = "heading 1") %>%
    body_add_img(src = img_file, width = 6, height = 4)

  # Usunięcie tymczasowych plików
  unlink(html_file)
  unlink(img_file)
}

# Zapisanie dokumentu Word
print(doc, target = "wszystkie_mapy.docx")
