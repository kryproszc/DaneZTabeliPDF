library(leaflet)
library(htmlwidgets)
library(officer)
library(magrittr)
library(webshot)
library(magick)

# Tworzenie nowego dokumentu Word
doc <- read_docx()

# Zakładam, że masz listę dataframe'ów lub inny sposób na generowanie danych do map
for (i in 1:n) {
  # Tworzenie mapy (przykład dla każdej iteracji)
  map <- leaflet(jednostki_data[[i]]) %>%
    addTiles() %>%
    setView(lng = 19.1451, lat = 51.9194, zoom = 6) %>%
    addPolygons(fillColor = ~ifelse(Value == 0, "transparent", pal(Value)), color = "#BDBDC3", weight = 1,
                fillOpacity = 0.7, smoothFactor = 0.5,
                popup = ~paste(JPT_NAZWA_, "<br>", "dddd", ": ", Value)) %>%
    addLegend(pal = pal, values = ~Value, opacity = 0.7, title = "Skala", position = "bottomright")
  
  # Zapisz mapę jako obiekt HTML do zmiennej
  temp_html <- htmlwidgets::saveWidget(map, file = NULL, selfcontained = TRUE)
  
  # Użyj webshot do konwersji obiektu HTML bez zapisu na dysk
  img <- webshot::webshot(temp_html, selector = "body", vwidth = 800, vheight = 600, delay = 0.5)

  # Przetwarzanie obrazu do formatu magick
  img_magick <- magick::image_read(img)
  
  # Dodanie obrazu do dokumentu Word
  doc <- doc %>% 
    body_add_par(paste("Mapa jednostek", i), style = "heading 1") %>%
    body_add_img(src = img_magick, width = 6, height = 4, style = "centered")
}

# Zapisanie dokumentu Word
print(doc, target = "wszystkie_mapy.docx")
