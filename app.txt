import numpy as np

class PCG32:
    def __init__(self, state=0x4d595df4d0f33173, inc=0x14057b7ef767814f):
        self.state = state
        self.inc = inc

    def random(self):
        oldstate = self.state
        self.state = oldstate * 6364136223846793005 + (self.inc | 1)
        xorshifted = (((oldstate >> 18) ^ oldstate) >> 27) & 0xFFFFFFFF
        rot = (oldstate >> 59) & 0xFFFFFFFF
        return (xorshifted >> rot) | (xorshifted << ((-rot) & 31)) & 0xFFFFFFFF

    def random_float(self, size=1):
        return np.array([self.random() / 0xFFFFFFFF for _ in range(size)], dtype=np.float32)

    def normal(self, mean, sigma, size=1):
        u1 = self.random_float(size)
        u2 = self.random_float(size)
        epsilon = np.finfo(float).eps
        u1 = np.clip(u1, epsilon, 1 - epsilon)  # Zapewnij, że u1 nigdy nie będzie dokładnie 0 ani 1
        z0 = np.sqrt(-2.0 * np.log(u1)) * np.cos(2.0 * np.pi * u2)
        return mean + z0 * sigma

    def lognormal(self, mean, sigma, size=1):
        normal_values = self.normal(mean, sigma, size)
        return np.exp(normal_values)

    def chisquare(self, df, size=1):
        normal_samples = self.normal(0, 1, size * df)
        normal_samples = normal_samples.reshape(size, df)
        return np.sum(normal_samples ** 2, axis=1)
