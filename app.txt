
# Przestrzenne przypisanie punktów do gmin
gminy <- st_transform(gminy, crs = 4326)  # Upewnienie się, że układ współrzędnych jest ten sam
punkty_gminy <- st_join(punkty_sf, gminy, join = st_within)
dim(punkty_gminy)
sum(coordinates$ilosc)

# 3. Sumowanie liczby budynków dla każdej gminy
# W kolumnie `nazwa_gminy` powinna być odpowiednia nazwa gminy w danych gminy.shp
wynik_gminy <- punkty_gminy %>%
  group_by(REGON) %>%  # Zastąp `nazwa_gminy` odpowiednią kolumną w danych gmin
  summarise(total_budynkow = sum(ilosc, na.rm = TRUE))
dim(wynik_gminy)
sum(wynik_gminy$total_budynkow)

wynik_gminy_df <- as.data.frame(wynik_gminy)

# Usunięcie kolumny geometry, aby uniknąć konfliktów przy łączeniu
wynik_gminy_df$geometry <- NULL

# Wykonanie `left_join` na podstawie kolumny `REGON`
gminy_z_budynkami <- left_join(gminy, wynik_gminy_df, by = "REGON")
dim(gminy)
dim(gminy_z_budynkami)
sum(wynik_gminy_df$total_budynkow,na.rm=TRUE)
# Sprawdzenie wynikowego połączenia
print(gminy_z_budynkami)
sum(gminy_z_budynkami$total_budynkow, na.rm = TRUE)
