# Załaduj wymagany pakiet
library(tmap)
library(sf)

# Wczytanie granic Polski z pliku SHP
polska <- st_read("gminy/gminy.shp")

# Wprowadź uzyskane współrzędne do ramki danych (przykładowe współrzędne dla Warszawy)
coordinates <- data.frame(
  latitude = 52.22985,  # Wprowadź uzyskaną szerokość geograficzną
  longitude = 21.00652  # Wprowadź uzyskaną długość geograficzną
)

# Konwersja ramki danych do obiektu przestrzennego (sf)
punkt_sf <- st_as_sf(coordinates, coords = c("longitude", "latitude"), crs = 4326)

# Przekształcenie układu współrzędnych pliku SHP na układ WGS 84, aby dopasować do punktu
polska <- st_transform(polska, crs = 4326)

# Znalezienie gminy, która zawiera podany punkt
gmina_sf <- polska[st_contains(polska, punkt_sf, sparse = FALSE), ]

# Sprawdzenie, czy gmina została znaleziona
if (nrow(gmina_sf) == 0) {
  stop("Nie znaleziono gminy dla podanych współrzędnych.")
}

# Rysowanie mapy przy użyciu tmap
tm_shape(polska) +
  tm_borders(col = "black") +  # Granice wszystkich gmin
  tm_shape(gmina_sf) +
  tm_fill(col = "yellow", alpha = 0.6) +  # Zaznaczenie znalezionej gminy na żółto
  tm_shape(punkt_sf) +
  tm_dots(col = "red", size = 0.5) +  # Zaznaczenie punktu na czerwono
  tm_layout(title = "Zaznaczenie gminy na mapie Polski") +
  tmap_mode("plot")  # Tryb renderowania wykresu

# Zapis mapy do pliku PNG
tmap_save(tm = last_map(), filename = "mapa_gmina.png", width = 10, height = 7, units = "in")
