library(readxl)
library(openxlsx)

# Wczytanie pliku Excela z zakładkami
plik_excel <- "nazwa_pliku.xlsx"  # Podaj nazwę swojego pliku Excel
wszystkie_zakladki <- excel_sheets(plik_excel)

# Wczytanie danych z zakładki "Szkody 2020-2023"
dane_szkody <- read_excel(plik_excel, sheet = "Szkody 2020-2023")

# Przykładowa operacja na danych, np. uzupełnianie braków średnią
dane_szkody_poprawione <- dane_szkody
dane_szkody_poprawione[is.na(dane_szkody_poprawione)] <- mean(dane_szkody_poprawione, na.rm = TRUE)

# Tworzenie nowego pliku Excel, do którego zapiszemy wszystkie zakładki
nowy_plik <- createWorkbook()

# Zapisanie każdej zakładki z oryginalnego pliku do nowego pliku
for (zakladka in wszystkie_zakladki) {
  # Wczytanie zakładki
  dane <- read_excel(plik_excel, sheet = zakladka)
  
  # Dodanie zakładki do nowego pliku, ale zamiast "Szkody 2020-2023" zmieniamy nazwę
  if (zakladka == "Szkody 2020-2023") {
    addWorksheet(nowy_plik, "Szkody 2020-2023_poprawa")
    writeData(nowy_plik, sheet = "Szkody 2020-2023_poprawa", dane_szkody_poprawione)
  } else {
    addWorksheet(nowy_plik, zakladka)
    writeData(nowy_plik, sheet = zakladka, dane)
  }
}

# Zapisanie nowego pliku Excel o nazwie "Form_poprawa.xlsx"
saveWorkbook(nowy_plik, file = "Form_poprawa.xlsx", overwrite = TRUE)

print("Nowy plik Excel zapisany z poprawioną zakładką.")
