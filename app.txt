get_coordinates_by_postcode <- function(data) {
  results <- data.frame(latitude = numeric(0), longitude = numeric(0), ilosc = numeric(0))
  
  for (i in 1:nrow(data)) {
    postcode <- data$kody[i]
    ilosc <- data$ilosc[i]
    
    
    url <- "http://dft-everace:8080/search.php"
    
    params <- list(q = postcode)
    
    response <- GET(url, query = params)
    
    if (status_code(response) == 200) {
      content_text <- content(response, "text", encoding = "UTF-8")
      response_json <- fromJSON(content_text, flatten = TRUE)
      
      
      if (!is.null(response_json$lat) && !is.null(response_json$lon)) {
        result_row <- data.frame(
          latitude = response_json$lat,
          longitude = response_json$lon,
          ilosc = ilosc
        )
        
        
        results <- rbind(results, result_row)
      } else {
        warning(paste("Brak danych geograficznych dla kodu:", postcode))
      }
    } else {
      warning(paste("BĹ‚Ä…d podczas zapytania dla kodu:", postcode, " - Kod odpowiedzi:", status_code(response)))
    }
  }
  
  
  if (nrow(results) == 0) {
    stop("Brak danych geograficznych dla podanych kodĂłw pocztowych.")
  }
  
  return(results)
}
