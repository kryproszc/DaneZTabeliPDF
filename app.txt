import socket
import json

def geocode_address(address):
    server_address = '172.25.9.44'
    server_port = 8080

    # Create a socket
    try:
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        print("Socket successfully created")
    except socket.error as err:
        print(f"Socket creation failed with error {err}")
        return

    # Connect to the server
    try:
        sock.connect((server_address, server_port))
        print("Successfully connected to the server")
    except socket.error as err:
        print(f"Connection to server failed with error {err}")
        return

    # Prepare HTTP GET request with the address as a query parameter
    request = f"GET /geocode?address={address.replace(' ', '%20')} HTTP/1.1\r\nHost: {server_address}\r\n\r\n"
    try:
        sock.sendall(request.encode())
    except socket.error as err:
        print(f"Failed to send request: {err}")
        return

    # Receive response
    try:
        response = sock.recv(4096)
        response_str = response.decode()
        print("Full response received from server:")
        print(response_str)

        # Extract JSON data from HTTP response
        header_end = response_str.find("\r\n\r\n")
        if header_end != -1:
            json_data = response_str[header_end+4:]
            print("Extracted JSON data:")
            print(json_data)
            try:
                data = json.loads(json_data)
                return data
            except json.JSONDecodeError as json_err:
                print(f"JSON decoding failed: {json_err}")
                return None
        else:
            print("No JSON data found in response")
            return None
    except socket.error as err:
        print(f"Failed to receive response: {err}")
    finally:
        sock.close()

def main():
    address = "Nowogrodzka 12, Warszawa, Polska"
    coordinates = geocode_address(address)
    if coordinates:
        print(f"Coordinates for the address '{address}':")
        print(f"Latitude: {coordinates.get('latitude')}, Longitude: {coordinates.get('longitude')}")
    else:
        print("Geocoding failed.")

if __name__ == "__main__":
    main()
