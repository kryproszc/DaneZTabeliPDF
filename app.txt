df_joined <- st_join(gminy, df_sf, join = st_within)

# Sprawdzenie, czy punkty zostały przypisane
print(head(df_joined))

# 6. Agregacja liczby budynków (`ilosc`) w każdej gminie na podstawie przypisanych punktów
# Upewniamy się, że suma `ilosc` z `df_sf` jest przypisana do odpowiednich gmin
gminy_with_count <- df_joined %>%
  group_by(JPT_KOD_JE) %>%  # Zakładam, że `JPT_KOD_JE` to unikalny identyfikator gminy
  summarize(ilosc_budynkow = sum(ilosc, na.rm = TRUE))  # Sumujemy `ilosc` w każdej gminie

# 7. Przypisanie liczby budynków z `df_sf` do gmin, które zawierają punkty
gminy_final <- left_join(gminy, gminy_with_count, by = "JPT_KOD_JE")

# 8. Sprawdzenie wyników przypisania
print(head(gminy_final))
