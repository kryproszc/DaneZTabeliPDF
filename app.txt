library(leaflet)
library(webshot)
library(htmlwidgets)
library(officer)
library(magrittr)

# Tworzenie nowego dokumentu Word
doc <- read_docx()

# Zakładam, że masz listę dataframe'ów lub inny sposób na generowanie danych do map
for (i in 1:n) {
  # Tworzenie mapy (przykład dla każdej iteracji)
  map <- leaflet(jednostki_data[[i]]) %>%
    addTiles() %>%
    setView(lng = 19.1451, lat = 51.9194, zoom = 6) %>%
    addPolygons(fillColor = ~ifelse(Value == 0, "transparent", pal(Value)), color = "#BDBDC3", weight = 1,
                fillOpacity = 0.7, smoothFactor = 0.5,
                popup = ~paste(JPT_NAZWA_, "<br>", "dddd", ": ", Value)) %>%
    addLegend(pal = pal, values = ~Value, opacity = 0.7, title = "Skala", position = "bottomright")
  
  # Zapisz mapę jako obiekt HTML w pamięci
  html_obj <- htmltools::as.tags(map)
  
  # Użyj webshot do konwersji obiektu HTML do obrazka bez zapisywania go na dysku
  img <- webshot::webshot(html_obj, cliprect = "viewport", vwidth = 800, vheight = 600, file = NULL)

  # Dodanie mapy do dokumentu Word bezpośrednio z obiektu
  doc <- doc %>% 
    body_add_par(paste("Mapa jednostek", i), style = "heading 1") %>%
    body_add_img(src = img, width = 6, height = 4)
}

# Zapisanie dokumentu Word
print(doc, target = "wszystkie_mapy.docx")
