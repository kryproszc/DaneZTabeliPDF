library(sf)
coordinates_sf <- st_as_sf(coordinates, coords = c("longitude", "latitude"), crs = 4326)
gminy_sf <- st_as_sf(gminy)  # Załóżmy, że gminy już są w formacie sf

# Dodajmy kolumnę REGON do coordinates na podstawie przestrzennej relacji
coordinates_with_regon <- st_join(coordinates_sf, gminy_sf, join = st_within)

# 3. Teraz połącz dane z `coordinates` z danymi `gminy` na podstawie REGON
# Przypisujemy liczbę budynków do każdej gminy
gminy_with_buildings <- gminy %>%
  left_join(coordinates_with_regon %>% 
              group_by(REGON) %>% 
              summarise(total_buildings = sum(ilosc, na.rm = TRUE)), by = "REGON")

# 4. Jeśli jakieś gminy nie mają przypisanych budynków (NA), zamieńmy na 0
gminy_with_buildings$total_buildings[is.na(gminy_with_buildings$total_buildings)] <- 0

# 5. Wyświetlenie wyników
print(gminy_with_buildings)
